<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin — Metrics</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #f6f8fb;
            color: #111;
            padding: 20px
        }

        .card {
            max-width: 900px;
            margin: 24px auto;
            padding: 18px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.06)
        }

        label {
            display: block;
            margin: 8px 0 6px
        }

        input[type=text] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px
        }

        button {
            margin-top: 10px;
            padding: 8px 12px;
            border: none;
            background: #764ba2;
            color: #fff;
            border-radius: 6px;
            cursor: pointer
        }

        pre {
            background: #0f1720;
            color: #dbeafe;
            padding: 12px;
            border-radius: 6px;
            overflow: auto
        }

        .row {
            display: flex;
            gap: 12px
        }

        .small {
            font-size: 0.9em;
            color: #555
        }
    </style>
</head>

<body>
    <div class="card">
        <h2>Admin — Log Shipping Metrics</h2>
        <p class="small">Enter the metrics token if required and click <strong>Refresh</strong>. Auto-refresh will poll
            every 5s.</p>

        <label for="token">Metrics Token (optional)</label>
        <input id="token" type="text" placeholder="Bearer token for /metrics" />

        <div class="row">
            <button id="refresh">Refresh</button>
            <button id="toggleAuto">Enable Auto-Refresh</button>
            <div style="flex:1"></div>
            <button id="openDemo" style="background:#2b7a78">Open Demo</button>
        </div>

        <h3 style="margin-top:18px">Metrics</h3>
        <pre id="out">(no data)</pre>
    </div>

    <script>
        const out = document.getElementById('out');
        const tokenInput = document.getElementById('token');
        const refreshBtn = document.getElementById('refresh');
        const toggleAuto = document.getElementById('toggleAuto');
        const openDemo = document.getElementById('openDemo');

        let auto = false;
        let timer = null;

        function renderJson(obj) {
            out.textContent = JSON.stringify(obj, null, 2);
        }

        async function fetchMetrics() {
            out.textContent = '(loading...)';
            try {
                const token = tokenInput.value.trim();
                const headers = { 'Accept': 'application/json' };
                if (token) headers['Authorization'] = `Bearer ${token}`;
                const res = await fetch('/metrics', { headers });
                if (res.status === 401 || res.status === 403) {
                    renderJson({ error: 'Unauthorized or Forbidden', status: res.status });
                    return;
                }
                const data = await res.json();
                renderJson(data);
            } catch (err) {
                renderJson({ error: err.message });
            }
        }

        refreshBtn.addEventListener('click', fetchMetrics);
        toggleAuto.addEventListener('click', () => {
            auto = !auto;
            toggleAuto.textContent = auto ? 'Disable Auto-Refresh' : 'Enable Auto-Refresh';
            if (auto) { timer = setInterval(fetchMetrics, 5000); } else { clearInterval(timer); }
        });

        openDemo.addEventListener('click', () => { window.location.href = '/'; });

        // initial fetch
        fetchMetrics();
    </script>
</body>

</html>